---
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>pouch-ai Dashboard</title>
	</head>
	<body class="bg-base-200 min-h-screen p-8">
		<div class="max-w-4xl mx-auto space-y-6">
            <!-- Header -->
            <div class="navbar bg-base-100 rounded-box shadow">
                <div class="flex-1">
                    <a class="btn btn-ghost text-xl">pouch-ai</a>
                </div>
                <div class="flex-none">
                    <div class="badge badge-primary">v0.1.0</div>
                </div>
            </div>

            <!-- Budget Card -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Budget Status</h2>
                    <div class="stats shadow">
                        <div class="stat">
                            <div class="stat-title">Current Balance</div>
                            <div class="stat-value text-primary" id="balanceDisplay">$0.00</div>
                            <div class="stat-desc">Remaining funds</div>
                        </div>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div class="join">
                        <input class="input input-bordered join-item" placeholder="Amount (USD)" id="amountInput" type="number" step="0.01"/>
                        <button class="btn btn-secondary join-item" id="setBudgetBtn">Set Balance</button>
                    </div>
                </div>
            </div>
            
            <!-- Instructions -->
             <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Configuration</h2>
                    <p>Point your clients to: <code class="bg-base-300 p-1 rounded">http://localhost:8080/v1</code></p>
                    <p>API Key: <code>(Managed internally)</code></p>
                </div>
            </div>
		</div>

        <script>
            const API_BASE = '/v1';
            
            async function fetchBalance() {
                try {
                    const res = await fetch(`${API_BASE}/stats/budget`);
                    const data = await res.json();
                    document.getElementById('balanceDisplay').innerText = `$${data.budget.toFixed(4)}`;
                } catch (e) {
                    console.error("Failed to fetch balance", e);
                }
            }

            document.getElementById('setBudgetBtn').addEventListener('click', async () => {
                const amount = parseFloat(document.getElementById('amountInput').value);
                if (isNaN(amount)) return;
                
                try {
                    await fetch(`${API_BASE}/stats/budget`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ amount })
                    });
                    fetchBalance();
                    document.getElementById('amountInput').value = '';
                } catch (e) {
                    alert("Failed to update budget");
                }
            });

            // Init
            fetchBalance();
            setInterval(fetchBalance, 5000);
        </script>
	</body>
</html>
